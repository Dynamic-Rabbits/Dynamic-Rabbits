/*
 * vb_detect.c
 *
 *      Author: john
 */

#include "vb_detect.h"
#include "drreg.h"
#include "string.h"
#include "../vb_private.h"

/* Dont bother passing vb_ctx via clean calls */
extern vb_context_t *vb_ctx;

void vb_handle_uaf_1_src(vb_heap_ptr_t *label) {

    vb_vuln_type_t type = VB_UAF_VULN;

    ub_opnd_access_t corrupt_slot;
    corrupt_slot.opnd_field = UB_SRC_OPND_1;
    corrupt_slot.comp_field = UB_COMP_1;

    vb_ctx->vun_func(type, (void *) label, &corrupt_slot, vb_ctx->user_data);
}

void vb_handle_uaf_2_src(vb_heap_ptr_t *label) {

    vb_heap_ptr_t *vb_heap_ptr = (vb_heap_ptr_t *) label;

    vb_vuln_type_t type = VB_UAF_VULN;

    ub_opnd_access_t corrupt_slot;
    corrupt_slot.opnd_field = UB_SRC_OPND_2;
    corrupt_slot.comp_field = UB_COMP_1;

    vb_ctx->vun_func(type, (void *) label, &corrupt_slot, vb_ctx->user_data);
}

void vb_handle_uaf_1_dst(vb_heap_ptr_t *label) {

    vb_heap_ptr_t *vb_heap_ptr = (vb_heap_ptr_t *) label;

    vb_vuln_type_t type = VB_UAF_VULN;

    ub_opnd_access_t corrupt_slot;
    corrupt_slot.opnd_field = UB_DST_OPND_1;
    corrupt_slot.comp_field = UB_COMP_1;

    vb_ctx->vun_func(type, (void *) label, &corrupt_slot, vb_ctx->user_data);
}

void vb_handle_double_free(vb_heap_ptr_t *label) {

    vb_vuln_type_t type = VB_DOUBLE_FREE_VULN;

    vb_ctx->vun_func(type, (void *) label, NULL, vb_ctx->user_data);
}

void vb_handle_hbo_1_src(vb_heap_ptr_t *label) {

    vb_heap_ptr_t *vb_heap_ptr = (vb_heap_ptr_t *) label;

    vb_vuln_type_t type = VB_HEAP_BO_VULN;

    ub_opnd_access_t corrupt_slot;
    corrupt_slot.opnd_field = UB_SRC_OPND_1;
    corrupt_slot.comp_field = UB_COMP_1;

    vb_ctx->vun_func(type, (void *) label, &corrupt_slot, vb_ctx->user_data);
}

void vb_handle_hbo_2_src(vb_heap_ptr_t *label) {

    vb_heap_ptr_t *vb_heap_ptr = (vb_heap_ptr_t *) label;

    vb_vuln_type_t type = VB_HEAP_BO_VULN;

    ub_opnd_access_t corrupt_slot;
    corrupt_slot.opnd_field = UB_SRC_OPND_2;
    corrupt_slot.comp_field = UB_COMP_1;

    vb_ctx->vun_func(type, (void *) label, &corrupt_slot, vb_ctx->user_data);
}

void vb_handle_hbo_1_dst(vb_heap_ptr_t *label) {

    vb_heap_ptr_t *vb_heap_ptr = (vb_heap_ptr_t *) label;

    vb_vuln_type_t type = VB_HEAP_BO_VULN;

    ub_opnd_access_t corrupt_slot;
    corrupt_slot.opnd_field = UB_DST_OPND_1;
    corrupt_slot.comp_field = UB_COMP_1;

    vb_ctx->vun_func(type, (void *) label, &corrupt_slot, vb_ctx->user_data);
}





