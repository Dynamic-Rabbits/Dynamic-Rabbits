/*
 * vb_rep_check.c
 *
 *      Author: john
 */

#include "vb_rep_check.h"

#include "drreg.h"
#include "string.h"

#include "../vb_private.h"
#include "vb_check.h"
#include "../instrumentation/vb_spill.h"

void vb_rep_movs_check_helper(void *drcontext, instrlist_t *ilist,
        instr_t *where, void *user_data, void *spill_data, size_t opnd_size) {

    vb_context_t *vb_ctx = (vb_context_t *) user_data;

    vb_rep_check(vb_ctx, opnd_size, true,
    true, UB_SRC_OPND_4, drcontext, ilist, where, vb_reg1, vb_reg2, vb_reg3);
}

void vb_rep_movsb_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_movs_check_helper(drcontext, ilist, where, user_data, spill_data, 1);
}

void vb_rep_movsw_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_movs_check_helper(drcontext, ilist, where, user_data, spill_data, 2);
}

void vb_rep_movsd_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_movs_check_helper(drcontext, ilist, where, user_data, spill_data, 4);
}

void vb_rep_movsq_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_movs_check_helper(drcontext, ilist, where, user_data, spill_data, 8);
}

void vb_rep_stos_check_helper(void *drcontext, instrlist_t *ilist,
        instr_t *where, void *user_data, void *spill_data, size_t opnd_size) {

    vb_context_t *vb_ctx = (vb_context_t *) user_data;

    vb_rep_check(vb_ctx, opnd_size, true,
    true, UB_SRC_OPND_3, drcontext, ilist, where, vb_reg1, vb_reg2, vb_reg3);
}

void vb_rep_stosb_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_stos_check_helper(drcontext, ilist, where, user_data, spill_data, 1);
}

void vb_rep_stosw_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_stos_check_helper(drcontext, ilist, where, user_data, spill_data, 2);
}

void vb_rep_stosd_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_stos_check_helper(drcontext, ilist, where, user_data, spill_data, 4);
}

void vb_rep_stosq_check(void *drcontext, instrlist_t *ilist, instr_t *where,
        instr_t *app_instr, void *user_data, void *spill_data) {

    vb_rep_stos_check_helper(drcontext, ilist, where, user_data, spill_data, 8);
}
